# Ansible Role

In Ansible, a role is a reusable and modular unit of configuration that organizes tasks, variables, files, templates, handlers, etc. Roles make playbooks cleaner and more maintainable.
This Ansible role installs Apache and renders a custom HTML page using a Jinja2 template.

## Directory Structure

```
apache/
├── defaults/
│   └── main.yml
├── handlers/
│   └── main.yml
├── inventory/
│   └── hosts
├── meta/
│   └── main.yml
├── tasks/
│   └── main.yml
├── templates/
│   └── index.html.j2
├── tests/
├── vars/
│   └── main.yml (optional)
├── README.md
cleanup.yml
role-playbook.yml
```

---

## Variables

### `defaults/main.yml`

```yaml
---
apache_port: 80
apache_doc_root: /var/www/html
```

---

## Tasks

### `tasks/main.yml`

```yaml
---
- name: Install Apache
  apt:
    name: apache2
    state: present
    update_cache: yes
  become: yes

- name: Start and enable Apache
  service:
    name: apache2
    state: started
    enabled: yes
  become: yes

- name: Deploy custom index.html
  template:
    src: index.html.j2
    dest: "{{ apache_doc_root }}/index.html"
  notify: Restart Apache
  become: yes
```

---

## Handlers

### `handlers/main.yml`

```yaml
---
- name: Restart Apache
  service:
    name: apache2
    state: restarted
```

---

## Template

### `templates/index.html.j2`

```html
<!DOCTYPE html>
<html>
<head>
    <title>Welcome</title>
</head>
<body>
    <h1>Hello from Apache Role!</h1>
    <p>This page is rendered by Ansible using a Jinja2 template.</p>
</body>
</html>
```

---

## Metadata

### `meta/main.yml`

```yaml
---
galaxy_info:
  role_name: apache
  author: your_name
  description: Install and configure Apache to serve a custom HTML page
  license: MIT
  min_ansible_version: 2.9
  platforms:
    - name: Debian
      versions:
        - buster
        - bullseye
    - name: Ubuntu
      versions:
        - focal
        - jammy

dependencies: []
```

---

## Playbook

### `role-playbook.yml`

```yaml
---
- name: Apply Apache Role
  hosts: webservers
  become: yes
  roles:
    - apache
```

---

## Hosts

### `hosts`

```ini
[webservers]
server_1 ansible_host=<Public_IP_1>

[all:vars]
ansible_python_interpreter=/usr/bin/python3
ansible_user=ubuntu
ansible_ssh_private_key_file=/home/ubuntu/keys/pem_key_name.pem
```

---

## Cleanup (Optional)

### `cleanup.yml`

```yaml
---
- name: Remove Apache
  hosts: webservers
  become: yes
  tasks:
    - name: Stop Apache
      service:
        name: apache2
        state: stopped

    - name: Uninstall Apache
      apt:
        name: apache2
        state: absent
        purge: yes

    - name: Remove index.html
      file:
        path: /var/www/html/index.html
        state: absent
```

---

## How to Use

1. Initialize your role (already done):

   ```bash
   ansible-galaxy init apache
   ```

2. Replace the generated files with the contents above.

3. Run the playbook:

   ```bash
   ansible-playbook -i inventory/hosts role-playbook.yml
   ```
   This will use the custom hosts file instead of global one which makes it more cleaner.
